const fs = require("fs");
const balanceFile = "./balance.json";

module.exports = {
  config: {
    name: "retire2",
    version: "1.1",
    author: "L'Uchiha Perdu",
    role: 1,
    shortDescription: "Retirer de l'argent d'un utilisateur",
    longDescription: "L'admin peut retirer de l'argent directement du compte d'un utilisateur.",
    category: "économie",
    guide: "{p}retire2 [UID] [montant]"
  },

  onStart: async function ({ args, message, event, usersData }) {
    const adminID = "61563822463333";
    const senderID = event.senderID;

    if (senderID !== adminID) return message.reply("🚫 | **Seul l'admin suprême peut utiliser cette commande !**");

    if (args.length < 2) return message.reply("⚠️ | **Utilisation correcte :** `/retire [UID] [montant]`");

    const targetID = args[0];
    const amount = parseInt(args[1]);

    if (isNaN(amount) || amount <= 0) return message.reply("❌ | **Montant invalide !**");

    let bankData = JSON.parse(fs.readFileSync(balanceFile));

    if (!bankData[targetID]) return message.reply("❌ | **Cet utilisateur n'existe pas dans la banque !**");
    if (bankData[targetID].balance < amount) return message.reply("😱 | **Fonds insuffisants dans le compte de la victime !**");

    // Retirer l'argent
    bankData[targetID].balance -= amount;
    fs.writeFileSync(balanceFile, JSON.stringify(bankData, null, 2));

    // Obtenir le nom de l'utilisateur concerné
    const userName = await usersData.getName(targetID);

    // Liste de messages funs pour l'admin
    const adminMessages = [
      `💰 | **Retrait effectué avec succès !**\n- ${amount} 💸 ont disparu mystérieusement du compte de ${userName} 😈`,
      `🏦 | **Opération terminée !**\n- ${userName} vient de perdre ${amount} 💸, une pensée pour lui... ou pas 😂`,
      `💸 | **L'argent a été siphonné avec élégance !**\n- ${userName} doit sûrement pleurer en ce moment... 😆`,
      `🕵️ | **Mission secrète accomplie !**\n- ${amount} 💸 ont été subtilisés à ${userName} sans qu'il ne comprenne rien !`,
      `💀 | **Dommage pour ${userName} !**\n- Son solde vient d’être allégé de ${amount} 💸, et toi, tu te marres 🤣`,
    ];

    // Liste de messages pour l'utilisateur ciblé
    const victimMessages = [
      `😱 | **ALERTE BANCAIRE !**\n- ${amount} 💸 viennent de disparaître de votre compte. Contactez immédiatement votre avocat !`,
      `🤬 | **Quelqu'un vient de te piquer ton oseille !**\n- ${amount} 💸 envolés... T’as un ennemi caché ? 🔥`,
      `😭 | **TRAGÉDIE FINANCIÈRE !**\n- Tu viens de perdre ${amount} 💸... Va vite pleurer dans un coin !`,
      `💸 | **Coup dur pour toi !**\n- Quelqu’un vient de voler ${amount} 💸 de ton compte... Faut mieux sécuriser tes sous ! 😅`,
      `⚠️ | **PROBLÈME BANCAIRE !**\n- On t’a retiré ${amount} 💸, et non, ce n'est pas une blague. Bonne chance... 😆`,
    ];

    // Envoyer un message à l'admin et à l'utilisateur ciblé
    message.reply(adminMessages[Math.floor(Math.random() * adminMessages.length)]);
    message.send(targetID, victimMessages[Math.floor(Math.random() * victimMessages.length)]);
  }
};