const fs = require("fs");
const balanceFile = "./balance.json";

module.exports = {
  config: {
    name: "retire2",
    version: "1.1",
    author: "L'Uchiha Perdu",
    role: 1,
    shortDescription: "Retirer de l'argent d'un utilisateur",
    longDescription: "L'admin peut retirer de l'argent directement du compte d'un utilisateur.",
    category: "Ã©conomie",
    guide: "{p}retire2 [UID] [montant]"
  },

  onStart: async function ({ args, message, event, usersData }) {
    const adminID = "61563822463333";
    const senderID = event.senderID;

    if (senderID !== adminID) return message.reply("ðŸš« | **Seul l'admin suprÃªme peut utiliser cette commande !**");

    if (args.length < 2) return message.reply("âš ï¸ | **Utilisation correcte :** `/retire [UID] [montant]`");

    const targetID = args[0];
    const amount = parseInt(args[1]);

    if (isNaN(amount) || amount <= 0) return message.reply("âŒ | **Montant invalide !**");

    let bankData = JSON.parse(fs.readFileSync(balanceFile));

    if (!bankData[targetID]) return message.reply("âŒ | **Cet utilisateur n'existe pas dans la banque !**");
    if (bankData[targetID].balance < amount) return message.reply("ðŸ˜± | **Fonds insuffisants dans le compte de la victime !**");

    // Retirer l'argent
    bankData[targetID].balance -= amount;
    fs.writeFileSync(balanceFile, JSON.stringify(bankData, null, 2));

    // Obtenir le nom de l'utilisateur concernÃ©
    const userName = await usersData.getName(targetID);

    // Liste de messages funs pour l'admin
    const adminMessages = [
      `ðŸ’° | **Retrait effectuÃ© avec succÃ¨s !**\n- ${amount} ðŸ’¸ ont disparu mystÃ©rieusement du compte de ${userName} ðŸ˜ˆ`,
      `ðŸ¦ | **OpÃ©ration terminÃ©e !**\n- ${userName} vient de perdre ${amount} ðŸ’¸, une pensÃ©e pour lui... ou pas ðŸ˜‚`,
      `ðŸ’¸ | **L'argent a Ã©tÃ© siphonnÃ© avec Ã©lÃ©gance !**\n- ${userName} doit sÃ»rement pleurer en ce moment... ðŸ˜†`,
      `ðŸ•µï¸ | **Mission secrÃ¨te accomplie !**\n- ${amount} ðŸ’¸ ont Ã©tÃ© subtilisÃ©s Ã  ${userName} sans qu'il ne comprenne rien !`,
      `ðŸ’€ | **Dommage pour ${userName} !**\n- Son solde vient dâ€™Ãªtre allÃ©gÃ© de ${amount} ðŸ’¸, et toi, tu te marres ðŸ¤£`,
    ];

    // Liste de messages pour l'utilisateur ciblÃ©
    const victimMessages = [
      `ðŸ˜± | **ALERTE BANCAIRE !**\n- ${amount} ðŸ’¸ viennent de disparaÃ®tre de votre compte. Contactez immÃ©diatement votre avocat !`,
      `ðŸ¤¬ | **Quelqu'un vient de te piquer ton oseille !**\n- ${amount} ðŸ’¸ envolÃ©s... Tâ€™as un ennemi cachÃ© ? ðŸ”¥`,
      `ðŸ˜­ | **TRAGÃ‰DIE FINANCIÃˆRE !**\n- Tu viens de perdre ${amount} ðŸ’¸... Va vite pleurer dans un coin !`,
      `ðŸ’¸ | **Coup dur pour toi !**\n- Quelquâ€™un vient de voler ${amount} ðŸ’¸ de ton compte... Faut mieux sÃ©curiser tes sous ! ðŸ˜…`,
      `âš ï¸ | **PROBLÃˆME BANCAIRE !**\n- On tâ€™a retirÃ© ${amount} ðŸ’¸, et non, ce n'est pas une blague. Bonne chance... ðŸ˜†`,
    ];

    // Envoyer un message Ã  l'admin et Ã  l'utilisateur ciblÃ©
    message.reply(adminMessages[Math.floor(Math.random() * adminMessages.length)]);
    message.send(targetID, victimMessages[Math.floor(Math.random() * victimMessages.length)]);
  }
};