module.exports = {
  config: {
    name: "hackbecome",
    version: "1.0",
    author: "L'Uchiha Perdu",
    countDown: 5,
    role: 2, // AccÃ¨s admin pour les utilisateurs
    shortDescription: { en: "Devenir un hackeur" },
    description: { en: "Permet Ã  un utilisateur de devenir hackeur en rÃ©solvant des Ã©nigmes" },
    category: "ğŸ’» Fun",
    guide: { en: "/hackbecome" }
  },

  onStart: async function ({ api, args, event }) {
    const userID = event.senderID;

    // VÃ©rifie si l'utilisateur est dÃ©jÃ  hackeur
    if (userIDIsHacker(userID)) {
      return api.sendMessage("ğŸš« Vous Ãªtes dÃ©jÃ  un hackeur. Continuez votre chemin ! ğŸ”", event.threadID);
    }

    // DÃ©fis de factorisation et quiz
    const challenges = [
      { question: "Quel est le facteur premier de 144 ?", answer: "12" },
      { question: "Quel est le rÃ©sultat de 37 x 11 ?", answer: "407" },
      { question: "Quel est le mot de passe secret pour pirater ?", answer: "1234" }
    ];

    // On envoie les dÃ©fis Ã  l'utilisateur
    const challengeIndex = Math.floor(Math.random() * challenges.length);
    const challenge = challenges[challengeIndex];

    api.sendMessage(`ğŸ§  Pour devenir hackeur, rÃ©pondez Ã  cette question :\n\n1) ${challenge.question}`, event.threadID);

    // Attente de la rÃ©ponse de l'utilisateur
    api.listen((reply) => {
      // VÃ©rifier si la rÃ©ponse est correctement formatÃ©e
      const answerRegex = /^1\)\s*(.+)$/;
      const match = reply.message.match(answerRegex);

      if (match) {
        const userAnswer = match[1].trim();

        if (userAnswer === challenge.answer) {
          api.sendMessage(`ğŸ‰ FÃ©licitations, vous Ãªtes dÃ©sormais un hackeur ! ğŸ”“`, event.threadID);
          addHacker(userID); // Fonction pour ajouter l'utilisateur comme hackeur
        } else {
          api.sendMessage("âŒ Mauvaise rÃ©ponse. RÃ©essayez encore. ğŸ’»", event.threadID);
        }
      } else {
        api.sendMessage("âŒ Format de rÃ©ponse invalide. RÃ©pondez sous ce format :\n1) <votre rÃ©ponse>", event.threadID);
      }
    });
  }
};

// Fonction pour ajouter l'utilisateur comme hackeur
function addHacker(userID) {
  const hackers = JSON.parse(fs.readFileSync("./hackers.json"));
  hackers.push(userID);
  fs.writeFileSync("./hackers.json", JSON.stringify(hackers, null, 2));
}

// VÃ©rifie si l'utilisateur est dÃ©jÃ  hackeur
function userIDIsHacker(userID) {
  const hackers = JSON.parse(fs.readFileSync("./hackers.json"));
  return hackers.includes(userID);
}