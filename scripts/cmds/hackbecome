const fs = require("fs");
const balanceFile = "balance.json";

const questions = [
    { question: "Combien font 12 x 8 ?", answer: "96" },
    { question: "Quel est le langage utilisÃ© pour coder un bot Node.js ?", answer: "javascript" },
    { question: "Qui est le crÃ©ateur de l'univers ?", answer: "L'Uchiha Perdu" }
];

module.exports = {
    config: {
        name: "hackbecome",
        version: "1.0",
        author: "L'Uchiha Perdu",
        role: 0,
        shortDescription: "Devenir hackeur en rÃ©pondant Ã  trois questions",
        longDescription: "Permet de passer un test pour devenir hackeur et utiliser la commande /hack2.",
        category: "Ã©conomie",
        guide: "{p}hackbecome rÃ©ponse"
    },

    onStart: async function ({ args, message, event }) {
        const userID = event.senderID;
        let bankData = JSON.parse(fs.readFileSync(balanceFile));

        if (!bankData[userID]) bankData[userID] = { cash: 0, bank: 0, debt: 0, secured: false, hacker: 0 };

        if (bankData[userID].hacker === 3) return message.reply("âš ï¸ **Vous Ãªtes dÃ©jÃ  hackeur !**");

        if (args.length === 0) {
            return message.reply(`ğŸ¤– **RÃ©pondez aux trois questions pour devenir hackeur !**\n\nğŸ’¬ **PremiÃ¨re question :**\nğŸ‘‰ ${questions[0].question}\n\nâš ï¸ RÃ©pondez sous cette forme :\n\`/hackbecome votre_rÃ©ponse\``);
        }

        const userAnswer = args.join(" ").toLowerCase();
        const currentQuestion = bankData[userID].hacker;

        if (userAnswer !== questions[currentQuestion].answer.toLowerCase()) {
            return message.reply("âŒ Mauvaise rÃ©ponse ! RÃ©essayez.");
        }

        bankData[userID].hacker += 1;
        fs.writeFileSync(balanceFile, JSON.stringify(bankData, null, 2));

        if (bankData[userID].hacker === 3) {
            return message.reply("ğŸ‰ **FÃ©licitations !** Vous Ãªtes maintenant un hackeur. Utilisez `/hack2` pour tenter de pirater des banques !");
        }

        return message.reply(`âœ… Bonne rÃ©ponse !\n\nğŸ’¬ **Question suivante :**\nğŸ‘‰ ${questions[bankData[userID].hacker].question}\n\nâš ï¸ RÃ©pondez sous cette forme :\n\`/hackbecome votre_rÃ©ponse\``);
    }
};